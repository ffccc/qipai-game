/*!
 * lhgcore Dialog Plugin v3.1.2
 * Date : 2010-05-17 09:30:11
 * Copyright (c) 2009 - 2010 By Li Hui Gang
 */
(function(a){function x(){return a.browser.ie?a.browser.i7?"":"javascript:''":"javascript:void(0);"}function y(){v||(v=999);return++v}function C(){var h=a.root(l);a(u).css({width:Math.max(h.scrollWidth,h.clientWidth||0)-1+"px",height:Math.max(h.scrollHeight,h.clientHeight||0)-1+"px"})}a.ui=a.ui||{};for(var m=window,u,l,s,v,D=0;m.parent!=m;)m=m.parent;l=m.document;a.fn.fixie6png=function(){for(var h=a("*",this),t,d=0,E=h.length;d<E;d++){t=a(h[d]).css("backgroundImage");if(t.indexOf(".png")!==-1){t=t.replace(/url\(|"|\)/g,"");h[d].style.backgroundImage="none";h[d].runtimeStyle.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"',sizingMethod='scale')"}}};a.ui.getScrollSize=function(h){h=h||window;if("pageXOffset"in h)return{x:h.pageXOffset||0,y:h.pageYOffset||0};else{h=a.root(h.document);return{x:h.scrollLeft||0,y:h.scrollTop||0}}};a.ui.getClientSize=function(h){h=a.root((h||window).document);return{w:h.clientWidth||0,h:h.clientHeight||0}};a.fn.dialog=function(h){var t=false;if(this[0])t=new a.ui.dialog(h,this[0]);return t};a.ui.dialog=function(h,t){var d=this.opt=a.extend({height:300,width:400,id:"lhgdlgId",event:"click",link:false,btns:true,fixed:false,drag:true,resize:true,top:"center",left:"center",title:"lhgdialog",regDragWindow:[]},h||{});if(d.SetTopWindow){m=d.SetTopWindow;l=m.document}if(D===0){if(a.browser.ie&&!a.browser.i7)try{l.execCommand("BackgroundImageCache",false,true)}catch(E){}D+=1}var c=this,z="",F,G=a.browser.ie&&!a.browser.i7?'<iframe hideFocus="true" frameborder="0" src="'+x()+'" style="position:absolute;z-index:-1;width:100%;height:100%;top:0px;left:0px;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>':"";if(d.html)z=typeof d.html==="string"?'<div id="inbox" class="inbox" style="display:none">'+d.html+"</div>":'<div id="inbox" class="inbox" style="display:none"></div>';else if(d.page)z=['<iframe frameborder="0" src="',d.page,'" scrolling="auto" id="lhgfrm" style="display:none;width:100%;height:100%;"></iframe>'].join("");F=['<div id="',d.id,'" class="lhgdig" style="width:',d.width,"px;height:",d.height,'px;"><table border="0" cellspacing="0" cellpadding="0"><tr><td class="leftTop"></td><td id="drag" class="top"><div class="titlelhgdig"><span id="icon" class="icon"></span>',d.title,'</div><div id="xbtn" class="xbtn"></div></td><td class="rightTop"></td></tr><tr><td class="left" id="digLeft"></td><td><table border="0" cellspacing="0" cellpadding="0"><tr><td id="content" class="content">',z,'<div id="throbber" class="throbber"><span id="load">loading...</span></div></td></tr>',d.btns?'<tr><td id="btns" class="btns"><div id="bDiv" class="bDiv"></div></td></tr>':"",'</table></td><td class="right"></td></tr><tr><td class="leftBottom"></td><td class="bottom"></td><td id="drop" class="rightBottom"></td></tr></table>',G,"</div>"].join("");s||(s=a('<div id="cDiv" style="position:absolute;top:0px;left:0px;border:1px solid #000;background-color:#999;display:none;"></div>',l).css("opacity",0.3).appendTo("body").bind("contextmenu",function(b){b.preventDefault()})[0]);this.ShowDialog=function(){if(!a("#"+d.id,l)[0]){d.cover&&this.ShowCover();var b=d.fixed&&(!a.browser.ie||a.browser.i7)?"fixed":"absolute";this.dlg=a(F,l).css({position:b,zIndex:y()}).appendTo(l.body)[0];this.iPos(this.dlg,d.top,d.left,d.fixed);this.setDialog(this.dlg);d.drag&&this.initDrag(a("#drag",this.dlg)[0]);d.resize&&this.initSize(a("#drop",this.dlg)[0]);if(a.browser.ie&&!a.browser.i7)(a("html",l).css("ie6PngRepair")==="true"?true:false)&&a(this.dlg).fixie6png();this.lhgDigxW=a("#digLeft",this.dlg)[0].offsetWidth*2;this.reContentSize(this.dlg);d.html&&d.cusfn&&d.cusfn();if(d.html){a("#throbber",this.dlg).css("display","none");a("#inbox",this.dlg)[0].style.display="inline-block"}}};this.iPos=function(b,g,i,j){var o=a.ui.getClientSize(m),p=a.ui.getScrollSize(m),f=b.offsetWidth,n=b.offsetHeight;if(j){if(a.browser.ie&&!a.browser.i7){a("html",l).addClass("lhgdig_ie6_fixed");a('<div class="lhgdig_warp"></div>',l).appendTo(l.body).append(b).css("zIndex",y())}lx=0;rx=o.w-f;cx=(rx-20)/2;ty=0;by=o.h-n;cy=(by-20)/2}else{lx=p.x;cx=p.x+(o.w-f-20)/2;rx=p.x+o.w-f;ty=p.y;cy=p.y+(o.h-n-20)/2;by=p.y+o.h-n}switch(i){case"center":i=cx;break;case"left":i=lx;break;case"right":i=rx;break;default:if(j)i-=p.x;i=i;break}switch(g){case"center":g=cy;break;case"top":g=ty;break;case"bottom":g=by;break;default:if(j)g-=p.y;g=g;break}a(b).css({top:g+"px",left:i+"px"})};this.setDialog=function(b){this.win=window;this.top=m;a(b).bind("contextmenu",function(g){g.preventDefault()}).bind("mousedown",c.setIndex);a("#xbtn",b).hover(function(){a(this).addClass("xbtnover")},function(){a(this).removeClass("xbtnover")}).click(c.cancel);d.html&&d.html.nodeType&&a("#inbox",b).append(d.html);this.regWindow=[window];d.regDragWindow.length>0&&this.regWindow.push(d.regDragWindow);m!=window&&this.regWindow.push(m);if(d.page){this.infrm=a("#lhgfrm",b)[0];if(!d.link){this.inwin=this.infrm.contentWindow;this.infrm.dg=this}a(this.infrm).bind("load",function(){if(!c.opt.link){a(a.browser.ie?this.contentWindow.document:this.contentWindow).bind("mousedown",c.setIndex);c.regWindow.push(this.contentWindow)}a("#throbber",c.dlg)[0].style.display="none";this.style.display="block"})}};this.reContentSize=function(b){var g=a("#drag",b)[0].offsetHeight,i=a("#drop",b)[0].offsetHeight,j=this.lhgDigxW,o=d.btns?a("#btns",b)[0].offsetHeight:0;j=parseInt(b.style.width,10)-j;g=parseInt(b.style.height,10)-g-i-o;a("#content",b).css({width:j+"px",height:g+"px"});d.html&&a("#inbox",b).css({width:j+"px",height:g+"px"});this.SetLoadLeft()};this.reDialogSize=function(b,g){a(this.dlg).css({width:b+"px",height:g+"px"});this.reContentSize(this.dlg)};this.initDrag=function(b){function g(e){e={x:e.screenX,y:e.screenY};f={x:f.x+(e.x-j.x),y:f.y+(e.y-j.y)};j=e;if(d.rang){if(f.x<q.x)f.x=q.x;if(f.y<q.y)f.y=q.y;if(f.x>o)f.x=o;if(f.y>p)f.y=p}a(s).css({left:f.x+"px",top:f.y+"px"})}function i(){for(var e=0,k=n.length;e<k;e++){a(n[e].document).unbind("mousemove",g);a(n[e].document).unbind("mouseup",i)}a.browser.ie&&s.releaseCapture();s.style.display="none";b=j=null;c.opt.fixed?a(c.dlg).css({left:f.x-q.x+"px",top:f.y-q.y+"px"}):a(c.dlg).css({left:f.x+"px",top:f.y+"px"})}var j,o,p,f,n=this.regWindow,r,q;a(b).bind("mousedown",function(e){if(e.target.id!=="xbtn"){r=a.ui.getClientSize(m);q=a.ui.getScrollSize(m);var k=c.dlg.offsetLeft,w=c.dlg.offsetTop,A=c.dlg.clientWidth,B=c.dlg.clientHeight;f=c.opt.fixed?{x:k+q.x,y:w+q.y}:{x:k,y:w};j={x:e.screenX,y:e.screenY};o=c.opt.fixed?r.w-A:r.w+q.x-A;p=c.opt.fixed?r.h-B:r.h+q.y-B;a(s).css({width:A-2+"px",height:B-2+"px",left:f.x+"px",top:f.y+"px",zIndex:parseInt(v,10)+2,display:""});k=0;for(w=n.length;k<w;k++){a(n[k].document).bind("mousemove",g);a(n[k].document).bind("mouseup",i)}e.preventDefault();a.browser.ie&&s.setCapture()}})};this.initSize=function(b){function g(e){e={x:e.screenX,y:e.screenY};r={w:e.x-j.x,h:e.y-j.y};if(r.w<200)r.w=200;if(r.h<100)r.h=100;a(s).css({width:r.w+"px",height:r.h+"px",top:f.y+"px",left:f.x+"px"})}function i(){for(var e=0,k=n.length;e<k;e++){a(n[e].document).unbind("mousemove",g);a(n[e].document).unbind("mouseup",i)}a.browser.ie&&s.releaseCapture();c.reDialogSize(r.w,r.h);s.style.display="none";b=j=null}var j,o,p,f,n=this.regWindow,r,q;a(b).bind("mousedown",function(e){p=c.dlg.clientWidth;o=c.dlg.clientHeight;a.ui.getClientSize(m);q=a.ui.getScrollSize(m);var k=c.dlg.offsetLeft,w=c.dlg.offsetTop;f=c.opt.fixed?{x:k+q.x,y:w+q.y}:{x:k,y:w};j={x:e.screenX-p,y:e.screenY-o};a(s).css({width:p-2+"px",height:o-2+"px",left:f.x+"px",top:f.y+"px",zIndex:parseInt(v,10)+2,display:""});k=0;for(w=n.length;k<w;k++){a(n[k].document).bind("mousemove",g);a(n[k].document).bind("mouseup",i)}e.preventDefault();a.browser.ie&&s.setCapture()})};this.setIndex=function(b){if(c.opt.fixed&&a.browser.ie&&!a.browser.i7){a(c.dlg).parent()[0].style.zIndex=parseInt(v,10)+1;v=parseInt(a(c.dlg).parent()[0].style.zIndex,10)}else{c.dlg.style.zIndex=parseInt(v,10)+1;v=parseInt(c.dlg.style.zIndex,10)}b.stopPropagation()};this.SetLoadLeft=function(){var b=(a("#content",this.dlg)[0].offsetWidth-a("#load",this.dlg)[0].offsetWidth)/2;a("#load",this.dlg)[0].style.left=b+"px"};this.addBtn=function(b,g,i){if(a("#"+b,this.dlg)[0])a("#"+b,this.dlg).html("<em>"+g+"</em>").click(i);else{b=a('<a id="'+b+'" class="button" href="javascript:void(0)" hidefocus="true"><em>'+g+"</em></a>",l).click(i)[0];a("#bDiv",this.dlg).append(b)}};this.removeBtn=function(b){a("#"+b,this.dlg)[0]&&a("#"+b,this.dlg).remove()};this.reload=function(b,g){b=b||window;c.cancel();b.location.href=g?g:b.location.href};this.ShowCover=function(){if(!u){var b=['<div style="position:absolute;top:0px;left:0px;background-color:#fff;">',G,"</div>"].join("");u=a(b,l).css("opacity",0.5).appendTo(l.body)[0]}a(m).bind("resize",C);C();a(u).css({display:"",zIndex:y()})};this.cancel=function(){var b=a("#lhgfrm",c.dlg)[0];if(b){c.opt.link||a(b.contentWindow).unbind("load");b.src=x()}c.regWindow=[];if(c.opt.fixed&&a.browser.ie&&!a.browser.i7){a("html",l).removeClass("lhgdig_ie6_fixed");a(c.dlg).parent().remove()}else a(c.dlg).remove();c.dlg=null;if(u)if(c.opt.parent&&c.opt.parent.opt.cover)u.style.zIndex=parseInt(c.opt.parent.dlg.style.zIndex,10)-1;else u.style.display="none"};this.cleanDialog=function(){if(c.dlg){var b=a("#lhgfrm",c.dlg)[0];if(b){c.opt.link||a(b.contentWindow).unbind("load");b.src=x()}if(c.opt.fixed&&a.browser.ie&&!a.browser.i7){a("html",l).removeClass("lhgdig_ie6_fixed");a(c.dlg).parent().remove()}else a(c.dlg).remove();c.dlg=null}};a(window).bind("unload",this.cleanDialog);t&&a(t).bind(d.event,function(){c.ShowDialog()})};a(window).bind("unload",function(){a(s).remove();s=null;if(u){a(u).remove();u=null}})})(lhgcore);